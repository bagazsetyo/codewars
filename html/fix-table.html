<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- bootstrap 4 cdn -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>

    <div id="tabPeserta" class="tab-pane active">
        <div class="table-responsive" style="overflow-x: scroll;">
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <td class="urutan"></td><input type="hidden" value="111111" name="Peserta[0][nip]"><input
                            type="hidden" value="111111" name="Type[0][nip]"><input type="hidden" value="Arren TU OPHI"
                            name="Peserta[0][nama]">
                        <td class="nama"></td>
                        <td class="golongan"></td>
                        <td><input type="text" value="2" class="jumlah_hari form-control input-sm jumlah_total"
                                name="Peserta[0][rincian][jumlah][jumlah_hari]" size="12" readonly="true"></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="tiket formatted form-control input-sm" name="Peserta[0][rincian][tiket]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][tiket]"
                                class="form-control keterangan-renkas select-tiket" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_representasi formatted form-control input-sm"
                                name="Peserta[0][rincian][uang_representasi]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][uang_representasi]"
                                class="form-control keterangan-renkas select-uang_representasi" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="hotel formatted form-control input-sm" name="Peserta[0][rincian][hotel]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][hotel]"
                                class="form-control keterangan-renkas select-hotel" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_harian formatted form-control input-sm"
                                name="Peserta[0][rincian][uang_harian]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][uang_harian]"
                                class="form-control keterangan-renkas select-uang_harian" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="taksi formatted form-control input-sm" name="Peserta[0][rincian][taksi]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][taksi]"
                                class="form-control keterangan-renkas select-taksi" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="jumlah formatted form-control input-sm" name="jumlah[jumlah]" size="12"
                                readonly="true" style="display: none;"></td>
                    </tr>
                    <tr>
                        <td>No</td>
                        <td>Nama</td>
                        <td>Gol</td>
                        <td>Jumlah Hari</td>
                        <td style="white-space:nowrap">Tiket </td>
                        <td style="white-space:nowrap"> Detail Renkas </td>
                        <td style="white-space:nowrap">Total Uang Representasi </td>
                        <td style="white-space:nowrap"> Detail Renkas </td>
                        <td style="white-space:nowrap">Total Hotel </td>
                        <td style="white-space:nowrap"> Detail Renkas </td>
                        <td style="white-space:nowrap">Total Uang Harian </td>
                        <td style="white-space:nowrap"> Detail Renkas </td>
                        <td style="white-space:nowrap">Taksi </td>
                        <td style="white-space:nowrap"> Detail Renkas </td>
                        <td style="white-space:nowrap">Jumlah </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="urutan">1</td><input type="hidden" value="111111" name="Peserta[0][nip]"><input
                            type="hidden" value="111111" name="Type[0][nip]"><input type="hidden" value="Arren TU OPHI"
                            name="Peserta[0][nama]">
                        <td class="nama">Arren TU OPHI</td>
                        <td class="golongan">IV/a</td>
                        <td><input type="text" value="2" class="jumlah_hari form-control input-sm jumlah_total"
                                name="Peserta[0][rincian][jumlah][jumlah_hari]" size="12" readonly="true"></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="tiket formatted form-control input-sm" name="Peserta[0][rincian][tiket]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][tiket]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_representasi formatted form-control input-sm"
                                name="Peserta[0][rincian][uang_representasi]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][uang_representasi]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="hotel formatted form-control input-sm" name="Peserta[0][rincian][hotel]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][hotel]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_harian formatted form-control input-sm"
                                name="Peserta[0][rincian][uang_harian]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][uang_harian]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="taksi formatted form-control input-sm" name="Peserta[0][rincian][taksi]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[0][keterangan][taksi]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="jumlah formatted form-control input-sm" name="jumlah[jumlah]" size="12"
                                readonly="true"></td>
                    </tr>
                    <tr>
                        <td class="urutan">2</td><input type="hidden" value="196811161999032007"
                            name="Peserta[1][nip]"><input type="hidden" value="196811161999032007"
                            name="Type[1][nip]"><input type="hidden" value="Novi Indiastuti, S.H., M.H."
                            name="Peserta[1][nama]">
                        <td class="nama">Novi Indiastuti, S.H., M.H.</td>
                        <td class="golongan">IV/a</td>
                        <td><input type="text" value="2" class="jumlah_hari form-control input-sm jumlah_total"
                                name="Peserta[1][rincian][jumlah][jumlah_hari]" size="12" readonly="true"></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="tiket formatted form-control input-sm" name="Peserta[1][rincian][tiket]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[1][keterangan][tiket]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_representasi formatted form-control input-sm"
                                name="Peserta[1][rincian][uang_representasi]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[1][keterangan][uang_representasi]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="hotel formatted form-control input-sm" name="Peserta[1][rincian][hotel]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[1][keterangan][hotel]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_harian formatted form-control input-sm"
                                name="Peserta[1][rincian][uang_harian]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[1][keterangan][uang_harian]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="taksi formatted form-control input-sm" name="Peserta[1][rincian][taksi]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[1][keterangan][taksi]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="jumlah formatted form-control input-sm" name="jumlah[jumlah]" size="12"
                                readonly="true"></td>
                    </tr>
                    <tr>
                        <td class="urutan">3</td><input type="hidden" value="6666666666" name="Peserta[2][nip]"><input
                            type="hidden" value="6666666666" name="Type[2][nip]"><input type="hidden"
                            value="Arren Operator TI" name="Peserta[2][nama]">
                        <td class="nama">Arren Operator TI</td>
                        <td class="golongan">IV/a</td>
                        <td><input type="text" value="2" class="jumlah_hari form-control input-sm jumlah_total"
                                name="Peserta[2][rincian][jumlah][jumlah_hari]" size="12" readonly="true"></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="tiket formatted form-control input-sm" name="Peserta[2][rincian][tiket]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[2][keterangan][tiket]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_representasi formatted form-control input-sm"
                                name="Peserta[2][rincian][uang_representasi]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[2][keterangan][uang_representasi]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="hotel formatted form-control input-sm" name="Peserta[2][rincian][hotel]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[2][keterangan][hotel]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="uang_harian formatted form-control input-sm"
                                name="Peserta[2][rincian][uang_harian]" size="12"></td>
                        <td style="min-width:150px"><select name="Type[2][keterangan][uang_harian]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="taksi formatted form-control input-sm" name="Peserta[2][rincian][taksi]"
                                size="12"></td>
                        <td style="min-width:150px"><select name="Type[2][keterangan][taksi]"
                                class="form-control keterangan-renkas" value="0">
                                <option data-max="0" value="0">Pilih</option>
                                <option data-max="4000000" value="127680">Snack Rapat</option>
                            </select></td>
                        <td style="min-width:150px"><input type="text" value="0"
                                class="jumlah formatted form-control input-sm" name="jumlah[jumlah]" size="12"
                                readonly="true"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><strong>JUMLAH</strong></td>
                        <td></td>
                        <td></td>
                        <td><input type="text" id="total_tiket" value="0"
                                class="total_tiket formatted form-control input-sm" name="total_tiket[]" size="12"></td>
                        <td></td>
                        <td><input type="text" id="total_uang_representasi" value="0"
                                class="total_uang_representasi formatted form-control input-sm"
                                name="total_uang_representasi[]" size="12"></td>
                        <td></td>
                        <td><input type="text" id="total_hotel" value="0"
                                class="total_hotel formatted form-control input-sm" name="total_hotel[]" size="12"></td>
                        <td></td>
                        <td><input type="text" id="total_uang_harian" value="0"
                                class="total_uang_harian formatted form-control input-sm" name="total_uang_harian[]"
                                size="12"></td>
                        <td></td>
                        <td><input type="text" id="total_taksi" value="0"
                                class="total_taksi formatted form-control input-sm" name="total_taksi[]" size="12"></td>
                        <td></td>
                        <td><input type="text" id="total_jumlah" value="0"
                                class="total_jumlah formatted form-control input-sm" name="total_jumlah[]" size="12">
                        </td>
                    </tr>
                </tbody>
                <tfoot></tfoot>
            </table>
        </div>
        <a class="btn btn-info pull-right nexttab noborder-radius" aria-expanded="true">Selanjutnya</a>
        <div class="clearfix"></div>
    </div>

    <!-- jquery 3 cdn -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>

    <script>
        // 
        var list = [
            { "label": "Snack Rapat", "value": "4000000", "id": "127680" }
        ];

        // $('.deleteOption').click(function (el) {
        //     var idKategori = $(this).parent().parent().find('input[type="hidden"]').val();
        //     $('#tabPeserta').find('tbody tr').each(function (index, el) {
        //         // find select all select 
        //         $(el).find('select').each(function (indexSelect, elementSelect) {
        //             // remove option where value == idKategori
        //             $(elementSelect).find('option[value="' + idKategori + '"]').remove();
        //         })
        //     });
        //     $(this).parent().parent().remove();
        // });

        // on click checkDetailRenkas
        $('#checkDetailRenkas').click(function (event) {
            var clicked = true;
            $('#tabPeserta').find('tbody tr').each(function (index, el) {
                // find select all select 
                $(el).find('select').each(function (indexSelect, elementSelect) {
                    // get name select 
                    var nameSelect = $(elementSelect).attr('name');
                    var nameInput = nameSelect.replace('Type', 'Peserta').replace('[keterangan]', '[rincian]');
                    // get value select
                    var valueSelect = $(elementSelect).val();
                    // get max value
                    var maxValue = $(elementSelect).find('option:selected').data('max');
                    // get input
                    var input = $(el).find('input[name="' + nameInput + '"]');
                    // get value input
                    var valueInput = $(input).val().replace(/\./g, '');
                    // check max value < valueInput
                    if (maxValue < parseInt(valueInput)) {
                        // set value input = max value
                        // $(input).val(maxValue);
                        $(input).val(maxValue.toString());
                        // alert
                        alert('Maaf, jumlah yang anda masukkan melebihi batas maksimal');
                        // set clicked = false
                        clicked = false;
                        throw new Error("Maaf, jumlah yang anda masukkan melebihi batas maksimal!");
                        return false;
                    }
                });
            });
            if (clicked) {
                // clicked input value Simpan
                $('#save-button').click();
            }
        });

        // var list = [];
        // $('#renkasSelected').find('tbody tr').each(function (index, el) {
        //     if ($(el).find('td:eq(5)').text().trim() != '' && $(el).find('td:eq(6)').text().trim()) {
        //         var getValue = $(el).find('td:eq(6)').text().trim();
        //         var maxValue = getValue.replace(/\./g, '')
        //         var id = $(el).find('td:eq(5)').find('input[type="hidden"]').val();
        //         list.push({
        //             label: $(el).find('td:eq(5)').text().trim(),
        //             value: maxValue,
        //             id: id,
        //         })
        //     }
        // });

        $('#tabPeserta table').find('tr').each(function (index, el) {

            if (index == 0) {
                $(el).find('select').each(function (indexSelect, elementSelect) {
                    var nameSelect = $(elementSelect).attr('name').split('[')[3].split(']')[0];
                    // add class with name nameSelect
                    $(elementSelect).addClass('select-' + nameSelect);
                });
            }

            $('.select-tiket').change(function (q) {
                var valueSelectAll = $(this).val();
                $('#tabPeserta table').find('tr').each(function (index, el) {
                    $(el).find('td:eq(5) select').each(function (index, el) {
                        $(el).val(valueSelectAll);
                    });
                });
            });

            $('.select-uang_representasi').change(function (q) {
                var valueSelectAll = $(this).val();
                $('#tabPeserta table').find('tr').each(function (index, el) {
                    $(el).find('td:eq(7) select').each(function (index, el) {
                        $(el).val(valueSelectAll);
                    });
                });
            });

            $('.select-hotel').change(function (q) {
                var valueSelectAll = $(this).val();
                $('#tabPeserta table').find('tr').each(function (index, el) {
                    $(el).find('td:eq(9) select').each(function (index, el) {
                        $(el).val(valueSelectAll);
                    });
                });
            });

            $('.select-uang_harian').change(function (q) {
                var valueSelectAll = $(this).val();
                $('#tabPeserta table').find('tr').each(function (index, el) {
                    $(el).find('td:eq(11) select').each(function (index, el) {
                        $(el).val(valueSelectAll);
                    });
                });
            });

            $('.select-taksi').change(function (q) {
                var valueSelectAll = $(this).val();
                $('#tabPeserta table').find('tr').each(function (index, el) {
                    $(el).find('td:eq(13) select').each(function (index, el) {
                        $(el).val(valueSelectAll);
                    });
                });
            });

            // $(el).find('td:eq(5) select option').remove();
            // $(el).find('td:eq(7) select option').remove();
            // $(el).find('td:eq(9) select option').remove();
            // $(el).find('td:eq(11) select option').remove();
            // $(el).find('td:eq(13) select option').remove();


            // $(el).find('td:eq(5) select').append('<option data-max="0" value="0">Pilih</option>');
            // $(el).find('td:eq(7) select').append('<option data-max="0" value="0">Pilih</option>');
            // $(el).find('td:eq(9) select').append('<option data-max="0" value="0">Pilih</option>');
            // $(el).find('td:eq(11) select').append('<option data-max="0" value="0">Pilih</option>');
            // $(el).find('td:eq(13) select').append('<option data-max="0" value="0">Pilih</option>');

            // $.each(list, function (index, val) {
            //     $(el).find('td:eq(5) select').append('<option data-max="' + val.value + '" value="' + val.id + '">' + val.label + '</option>')
            //     $(el).find('td:eq(7) select').append('<option data-max="' + val.value + '" value="' + val.id + '">' + val.label + '</option>')
            //     $(el).find('td:eq(9) select').append('<option data-max="' + val.value + '" value="' + val.id + '">' + val.label + '</option>')
            //     $(el).find('td:eq(11) select').append('<option data-max="' + val.value + '" value="' + val.id + '">' + val.label + '</option>')
            //     $(el).find('td:eq(13) select').append('<option data-max="' + val.value + '" value="' + val.id + '">' + val.label + '</option>')
            // });
        });
        $('#tabPeserta table tbody input').on('change', function (event) {
            var name = $(this).attr('name');
            var value = $(this).val();

            var nameSelectKategori = name.replace('Peserta', 'Type').replace('rincian', 'keterangan');

            var parent = $(this).parents('tr').find('select[name="' + nameSelectKategori + '"]');

            value = Number(value.replace(/[^0-9.-]+/g, ''));
            // javascript loop for
            for (var i = 0; i < list.length; i++) {
                if (list[i].id == parent.val()) {
                    if (value > list[i].value) {
                        $(this).val(list[i].value);
                        alert('Jumlah melebihi sisa pagu');
                        throw new Error("Maaf, jumlah yang anda masukkan melebihi batas maksimal!");
                    }
                } else if (parent.val() == 0 && value > 0) {
                    $(this).val(0);
                    alert('Jumlah melebihi sisa pagu');
                    throw new Error("Maaf, jumlah yang anda masukkan melebihi batas maksimal!");
                }
            }

        })
    </script>
</body>

</html>